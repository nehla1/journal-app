{% extends "base.html" %}
{% block title %}Calendar{% endblock %}
{% block content %}
  <h1>Calendar</h1>
  <div class="calendar-nav">
    <button id="prevMonth">&lt; Prev</button>
    <span id="monthYear"></span>
    <button id="nextMonth">Next &gt;</button>
  </div>
  <div id="calendar"></div>

  <h2>Entries</h2>
  <div id="entries-container">
    {% for e in entries %}
      <div class="entry" data-date="{{ e['entry_date'] }}">
        <h3>{{ e['entry_date'] }} {% if e['journal_id'] %} - Journal {{ e['journal_id'] }}{% endif %}</h3>
        <p>{{ e['content'] }}</p>
        <small>By {{ e['owner_email'] }}</small>
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% block scripts %}
<script>
// CLIENT-SIDE calendar code similar to earlier templates
const calendar = document.getElementById('calendar');
const entriesList = Array.from(document.querySelectorAll('.entry'));
const uniqueDates = [...new Set(entriesList.map(e => e.dataset.date))];
const monthYearLabel = document.getElementById('monthYear');
let currentDate = new Date();

function renderCalendar(date) {
    calendar.innerHTML = '';
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    monthYearLabel.textContent = `${monthNames[month]} ${year}`;

    for (let i = 0; i < firstDay; i++) calendar.appendChild(document.createElement('div'));

    for (let d = 1; d <= lastDate; d++) {
        const btn = document.createElement('button');
        const dayStr = String(d).padStart(2,'0');
        const monthStr = String(month+1).padStart(2,'0');
        const ds = `${year}-${monthStr}-${dayStr}`;
        btn.textContent = d;
        if (uniqueDates.includes(ds)) {
            btn.classList.add('active-date');
        }
        btn.onclick = () => {
            entriesList.forEach(en => {
                en.style.display = en.dataset.date === ds ? 'block' : 'none';
            });
        };
        calendar.appendChild(btn);
    }
    entriesList.forEach(en => en.style.display = 'block');
}

document.getElementById('prevMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(currentDate); };
document.getElementById('nextMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(currentDate); };
renderCalendar(currentDate);
</script>
{% endblock %}
